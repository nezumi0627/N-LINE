# アップデーター機能

N-LINEアプリケーションに組み込まれたアップデーター機能の説明です。

## 概要

アプリケーション内から最新バージョンを確認し、更新をダウンロード・インストールできる機能です。

## 機能

### バージョン確認

- GitHub Releases APIから最新バージョンを取得
- 現在のバージョンと比較
- 更新の有無を通知

### ダウンロード

- 最新バージョンのインストーラーをダウンロード
- 進捗バーでダウンロード状況を表示
- 一時ディレクトリに保存

### インストール

- ダウンロードしたインストーラーを自動実行
- サイレントインストールモードで実行
- アプリケーションを自動終了

## 使用方法

### アプリケーション内から

1. メインウィンドウのフッターにある「更新を確認」ボタンをクリック
2. アップデートダイアログが開きます
3. 「確認」ボタンで最新バージョンをチェック
4. 更新がある場合、「ダウンロード」ボタンでダウンロード
5. ダウンロード完了後、「インストール」ボタンでインストール

### 自動チェック（将来実装）

起動時に自動的にバージョンをチェックする機能を追加できます。

## 設定

### バージョン情報のURL

`src/n_line/core/updater.py`の`VERSION_URL`を変更することで、バージョン情報の取得元を変更できます。

```python
# GitHub Releases APIを使用
VERSION_URL = "https://api.github.com/repos/yourusername/n-line/releases/latest"

# カスタムAPIエンドポイントを使用
VERSION_URL = "https://your-domain.com/api/version"
```

### カスタムAPIエンドポイント

カスタムAPIエンドポイントを使用する場合、以下のJSON形式で応答する必要があります：

```json
{
  "tag_name": "v0.3.0",
  "assets": [
    {
      "name": "N-LINE-Setup-0.3.0.exe",
      "browser_download_url": "https://example.com/downloads/N-LINE-Setup-0.3.0.exe"
    }
  ]
}
```

## バージョン管理

### バージョン番号の更新

すべてのファイルでバージョン番号を一貫して管理します：

```bash
# バージョンを更新
python scripts/bump_version.py patch  # 0.2.0 -> 0.2.1
python scripts/bump_version.py minor  # 0.2.0 -> 0.3.0
python scripts/bump_version.py major  # 0.2.0 -> 1.0.0

# 直接バージョンを指定
python scripts/bump_version.py 0.3.0
```

### 更新されるファイル

- `pyproject.toml` - プロジェクトメタデータ
- `src/n_line/__init__.py` - パッケージバージョン
- `installer.iss` - インストーラーバージョン

### バージョンの確認

```bash
# バージョンの一貫性を確認
python scripts/check_version.py
```

## トラブルシューティング

### ネットワークエラー

- インターネット接続を確認
- ファイアウォールの設定を確認
- プロキシ設定を確認

### ダウンロードエラー

- 一時ディレクトリの空き容量を確認
- ウイルス対策ソフトがブロックしていないか確認
- 手動でダウンロードしてインストール

### インストールエラー

- 管理者権限が必要な場合があります
- 既存のインストールをアンインストールしてから再インストール

## セキュリティ

- ダウンロードURLはHTTPSを使用
- インストーラーの署名を確認（将来実装）
- チェックサムの検証（将来実装）

## 将来の改善

- 自動更新チェック
- バックグラウンドダウンロード
- 差分更新
- ロールバック機能

